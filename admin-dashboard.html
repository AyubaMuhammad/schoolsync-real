<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SchoolSync - Admin Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4a6cf7;
      --primary-dark: #3a5bd9;
      --secondary: #ff9f43;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #333;
      --gray: #666;
      --light-gray: #e9ecef;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light);
      color: var(--dark);
      display: flex;
      min-height: 100vh;
    }

    /* ====== SIDEBAR ====== */
    .sidebar {
      width: 280px;
      background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
      color: white;
      padding: 25px 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    
    .sidebar-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    .sidebar-header h1 {
      font-size: 1.5rem;
      color: white;
      margin-bottom: 5px;
    }
    
    .sidebar-header p {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
    }
    
    .sidebar-nav {
      flex: 1;
    }
    
    .sidebar a {
      display: flex;
      align-items: center;
      padding: 14px 18px;
      margin: 6px 0;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s;
      font-size: 0.95rem;
    }
    
    .sidebar a i {
      margin-right: 12px;
      width: 20px;
      text-align: center;
    }
    
    .sidebar a:hover,
    .sidebar a.active {
      background: rgba(255,255,255,0.15);
      transform: translateX(5px);
    }

    /* ====== MAIN ====== */
    .main {
      flex: 1;
      padding: 30px;
      background: var(--light);
      overflow-y: auto;
    }
    
    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .main-header h1 {
      color: var(--primary);
      font-size: 28px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .user-info img {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      margin-right: 12px;
    }

    .panel {
      display: none;
    }
    
    .panel.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ====== DASHBOARD STATS ====== */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      transition: transform 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 20px;
      font-size: 24px;
    }
    
    .stat-icon.primary {
      background: rgba(74, 108, 247, 0.2);
      color: var(--primary);
    }
    
    .stat-icon.success {
      background: rgba(40, 167, 69, 0.2);
      color: var(--success);
    }
    
    .stat-icon.warning {
      background: rgba(255, 193, 7, 0.2);
      color: var(--warning);
    }
    
    .stat-icon.danger {
      background: rgba(220, 53, 69, 0.2);
      color: var(--danger);
    }
    
    .stat-info h3 {
      font-size: 28px;
      margin-bottom: 5px;
    }
    
    .stat-info p {
      color: var(--gray);
      font-size: 14px;
    }

    /* ====== CARDS ====== */
    .card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .card h2 {
      color: var(--primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }
    
    .card h2 i {
      margin-right: 10px;
    }

    /* ====== FORMS ====== */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .btn {
      padding: 12px 25px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
      display: inline-flex;
      align-items: center;
    }
    
    .btn i {
      margin-right: 8px;
    }
    
    .btn:hover {
      background: var(--primary-dark);
    }
    
    .btn-success {
      background: var(--success);
    }
    
    .btn-success:hover {
      background: #218838;
    }
    
    .btn-warning {
      background: var(--warning);
      color: #000;
    }
    
    .btn-warning:hover {
      background: #e0a800;
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-danger:hover {
      background: #c82333;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    /* ====== STUDENT CARDS ====== */
    .students-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .student-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      padding: 20px;
      transition: transform 0.3s;
    }
    
    .student-card:hover {
      transform: translateY(-5px);
    }
    
    .student-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .student-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 15px;
    }
    
    .student-info h3 {
      margin-bottom: 5px;
    }
    
    .student-info p {
      color: var(--gray);
      font-size: 14px;
    }
    
    .student-details {
      margin-bottom: 15px;
    }
    
    .student-details p {
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .student-actions {
      display: flex;
      gap: 10px;
    }
    
    .student-actions button {
      flex: 1;
      padding: 8px 12px;
      font-size: 14px;
    }
    
    .category-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .badge-scholarship { background: var(--success); color: white; }
    .badge-honors { background: var(--primary); color: white; }
    .badge-disabled { background: var(--danger); color: white; }
    .badge-athlete { background: #8b5cf6; color: white; }
    .badge-international { background: #ec4899; color: white; }
    
    /* Status indicators */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-active { background-color: var(--success); }
    .status-inactive { background-color: var(--danger); }

    /* ====== TABLES ====== */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      border-radius: 10px;
      overflow: hidden;
    }
    
    table th {
      background-color: var(--primary);
      color: white;
      text-align: left;
      padding: 15px;
    }
    
    table td {
      padding: 15px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    table tr:last-child td {
      border-bottom: none;
    }
    
    table tr:nth-child(even) {
      background-color: var(--light);
    }

    /* ====== FILTERS ====== */
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .filters select, .filters input {
      padding: 10px 12px;
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      flex: 1;
      min-width: 150px;
    }

    /* ====== SEARCH SECTION ====== */
    .search-section {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    /* ====== NOTIFICATION ====== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
    }
    
    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--danger);
    }
    
    .notification.warning {
      background: var(--warning);
      color: #000;
    }

    /* ====== MODAL ====== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    /* ====== DARK MODE ====== */
    body.dark-mode {
      background-color: #1e1e2f;
      color: #f0f0f0;
    }
    
    body.dark-mode .main {
      background-color: #2c2c3e;
    }
    
    body.dark-mode .sidebar {
      background: linear-gradient(to bottom, #111827, #0f172a);
    }
    
    body.dark-mode .card,
    body.dark-mode .stat-card,
    body.dark-mode .student-card {
      background-color: #3a3a52;
      color: #f0f0f0;
    }
    
    body.dark-mode h1,
    body.dark-mode h2,
    body.dark-mode h3,
    body.dark-mode p {
      color: #f0f0f0;
    }
    
    body.dark-mode table, 
    body.dark-mode th, 
    body.dark-mode td {
      border-color: #444;
    }
    
    body.dark-mode th {
      background-color: #333;
    }
    
    body.dark-mode .form-control {
      background-color: #2c2c3e;
      color: #f0f0f0;
      border-color: #444;
    }
    
    body.dark-mode .search-section {
      background-color: #2c2c3e;
    }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 992px) {
      .dashboard-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .students-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        padding: 20px;
      }
      
      .sidebar-nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }
      
      .sidebar a {
        flex: 1 1 48%;
        margin: 5px;
        font-size: 14px;
        justify-content: center;
        text-align: center;
      }
      
      .sidebar a i {
        margin-right: 0;
        margin-bottom: 5px;
        display: block;
      }
      
      .main {
        padding: 20px;
      }
      
      .main-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .user-info {
        margin-top: 15px;
      }
      
      .dashboard-stats {
        grid-template-columns: 1fr;
      }
      
      .students-grid {
        grid-template-columns: 1fr;
      }
      
      .filters {
        flex-direction: column;
      }
    }

    @media (max-width: 576px) {
      .sidebar a {
        flex: 1 1 100%;
      }
      
      .student-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h1><i class="fas fa-graduation-cap"></i> SchoolSync Admin</h1>
      <p>School Management System</p>
    </div>
    
    <div class="sidebar-nav">
      <a href="#" class="active" data-panel="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="#" data-panel="special-students"><i class="fas fa-user-graduate"></i> Special Students</a>
      <a href="#" data-panel="teacher"><i class="fas fa-chalkboard-teacher"></i> Teachers</a>
      <a href="#" data-panel="classes"><i class="fas fa-book"></i> Classes</a>
      <a href="#" data-panel="attendance"><i class="fas fa-clipboard-check"></i> Attendance</a>
      <a href="#" data-panel="admissions"><i class="fas fa-file-signature"></i> Admissions</a>
      <a href="#" data-panel="payments"><i class="fas fa-credit-card"></i> Payments</a>
      <a href="#" data-panel="reports"><i class="fas fa-chart-bar"></i> Reports</a>
      <a href="#" data-panel="messaging"><i class="fas fa-comments"></i> Messaging</a>
      <a href="#" data-panel="audit"><i class="fas fa-history"></i> Audit</a>
      <a href="#" data-panel="settings"><i class="fas fa-cog"></i> Settings</a>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main">
    <div class="main-header">
      <h1 id="panelTitle">Dashboard</h1>
      <div class="user-info">
        <img src="https://placehold.co/45x45" alt="Admin" />
        <span>Administrator</span>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section id="dashboard" class="panel active">
      <div class="dashboard-stats">
        <div class="stat-card">
          <div class="stat-icon primary">
            <i class="fas fa-user-graduate"></i>
          </div>
          <div class="stat-info">
            <h3 id="specialStudentsCount">25</h3>
            <p>Special Students</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon success">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
          <div class="stat-info">
            <h3 id="teacherCount">18</h3>
            <p>Teachers</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-info">
            <h3 id="studentCount">245</h3>
            <p>Total Students</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon danger">
            <i class="fas fa-book"></i>
          </div>
          <div class="stat-info">
            <h3 id="classCount">12</h3>
            <p>Classes</p>
          </div>
        </div>
      </div>
      
      <div class="search-section">
        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
        <div class="action-buttons">
          <button class="btn" onclick="showPanel('special-students')"><i class="fas fa-plus"></i> Add New Student</button>
          <button class="btn btn-success" onclick="showPanel('teacher')"><i class="fas fa-user-plus"></i> Add Teacher</button>
          <button class="btn btn-warning" onclick="app.exportData()"><i class="fas fa-download"></i> Export Data</button>
          <button class="btn btn-danger" onclick="app.generateReport()"><i class="fas fa-chart-pie"></i> Generate Report</button>
        </div>
      </div>
      
      <div class="card">
        <h2><i class="fas fa-chart-line"></i> Recent Activity</h2>
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Activity</th>
              <th>User</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody id="recentActivity">
            <tr>
              <td>2024-05-15</td>
              <td>New student registration</td>
              <td>Alex Johnson</td>
              <td>Grade 5 - Blue</td>
            </tr>
            <tr>
              <td>2024-05-14</td>
              <td>Teacher assignment</td>
              <td>Ms. Sarah</td>
              <td>Mathematics - Grade 5</td>
            </tr>
            <tr>
              <td>2024-05-13</td>
              <td>Payment received</td>
              <td>Emma Wilson</td>
              <td>Tuition fee</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- SPECIAL STUDENT MANAGEMENT -->
    <section id="special-students" class="panel">
      <div class="card">
        <h2><i class="fas fa-user-graduate"></i> Special Student Management</h2>
        
        <div class="filters">
          <select id="specialFilter" class="form-control">
            <option value="all">All Special Students</option>
            <option value="scholarship">Scholarship Students</option>
            <option value="honors">Honors Program</option>
            <option value="disabled">Special Needs</option>
            <option value="athlete">Student Athletes</option>
            <option value="international">International Students</option>
          </select>
          <input type="text" id="specialSearch" class="form-control" placeholder="Search special students...">
          <button class="btn" onclick="app.renderSpecialStudents()"><i class="fas fa-search"></i> Search</button>
        </div>

        <form id="specialStudentsForm">
          <div class="form-row">
            <div class="form-group">
              <label for="specialName">Name</label>
              <input type="text" id="specialName" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="specialId">ID</label>
              <input type="text" id="specialId" class="form-control" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="specialClass">Class</label>
              <input type="text" id="specialClass" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="specialCategory">Special Category</label>
              <select id="specialCategory" class="form-control" required>
                <option value="">Select Category</option>
                <option value="scholarship">Scholarship</option>
                <option value="honors">Honors Program</option>
                <option value="disabled">Special Needs</option>
                <option value="athlete">Student Athlete</option>
                <option value="international">International Student</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="specialEmail">Email</label>
            <input type="email" id="specialEmail" class="form-control" />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="specialPhoto">Upload Photo</label>
              <input type="file" id="specialPhoto" class="form-control" accept="image/*" />
            </div>
            <div class="form-group">
              <img id="specialPhotoPreview" src="https://placehold.co/100x100" alt="Profile" width="100" height="100" style="border-radius: 8px;" />
            </div>
          </div>

          <div class="form-group">
            <label for="specialNotes">Special Notes</label>
            <textarea id="specialNotes" class="form-control" rows="3" placeholder="Additional information about special requirements or accommodations"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="specialStatus">Status</label>
              <select id="specialStatus" class="form-control">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
            <div class="form-group">
              <label for="enrollmentDate">Enrollment Date</label>
              <input type="date" id="enrollmentDate" class="form-control" />
            </div>
          </div>

          <div class="form-group">
            <label for="specialPassword">Password</label>
            <input type="password" id="specialPassword" class="form-control" required />
          </div>

          <div class="action-buttons">
            <button type="submit" id="submitSpecialBtn" class="btn"><i class="fas fa-plus"></i> Add Special Student</button>
            <button type="button" id="cancelEditBtn" class="btn btn-warning" style="display:none;" onclick="app.cancelEdit()"><i class="fas fa-times"></i> Cancel</button>
            <button type="button" class="btn btn-danger" onclick="app.clearForm()"><i class="fas fa-trash"></i> Clear Form</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h2><i class="fas fa-list"></i> Special Students List</h2>
        <div id="specialStudentsList" class="students-grid"></div>
      </div>
    </section>

    <!-- TEACHER MANAGEMENT -->
    <section id="teacher" class="panel">
      <div class="card">
        <h2><i class="fas fa-chalkboard-teacher"></i> Teacher Management</h2>
        
        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-icon primary">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
              <h3 id="totalTeacherCount">18</h3>
              <p>Total Teachers</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon success">
              <i class="fas fa-book"></i>
            </div>
            <div class="stat-info">
              <h3 id="activeClassCount">12</h3>
              <p>Active Classes</p>
            </div>
          </div>
        </div>

        <form id="teacherForm">
          <div class="form-row">
            <div class="form-group">
              <label for="teacherNameInput">Teacher Name</label>
              <input type="text" id="teacherNameInput" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="teacherIDInput">Teacher ID</label>
              <input type="text" id="teacherIDInput" class="form-control" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="teacherClassInput">Class</label>
              <input type="text" id="teacherClassInput" class="form-control" required />
            </div>
            <div class="form-group">
              <label for="teacherEmailInput">Email</label>
              <input type="email" id="teacherEmailInput" class="form-control" />
            </div>
          </div>

          <div class="form-group">
            <label for="teacherPasswordInput">Password</label>
            <input type="password" id="teacherPasswordInput" class="form-control" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="teacherPhotoInput">Upload Photo</label>
              <input type="file" id="teacherPhotoInput" class="form-control" accept="image/*" />
            </div>
            <div class="form-group">
              <img id="teacherPhotoPreview" src="https://placehold.co/100x100" alt="Preview" width="100" height="100" style="border-radius:50%;object-fit:cover;" />
            </div>
          </div>

          <div class="action-buttons">
            <button type="submit" id="saveTeacherBtn" class="btn">
              <span id="saveButtonText"><i class="fas fa-plus"></i> Add Teacher</span>
            </button>
            <button type="reset" class="btn btn-danger"><i class="fas fa-trash"></i> Clear</button>
          </div>
        </form>
      </div>

      <div class="card">
        <h2><i class="fas fa-list"></i> Teacher List</h2>
        <table id="teacherTable">
          <thead>
            <tr>
              <th>Photo</th>
              <th>Name</th>
              <th>ID</th>
              <th>Class</th>
              <th>Email</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
<div class="action-buttons" style="margin-top: 20px;">
    <button class="btn btn-success" onclick="teacherManager.exportTeachers()">
        <i class="fas fa-download"></i> Export Teachers
    </button>
    <button class="btn btn-warning" onclick="teacherManager.generateSampleData()">
        <i class="fas fa-magic"></i> Generate Sample Data
    </button>
    <input type="file" id="teacherImportFile" accept=".json" style="display: none;" 
           onchange="teacherManager.importTeachers(this.files[0])">
    <button class="btn btn-info" onclick="document.getElementById('teacherImportFile').click()">
        <i class="fas fa-upload"></i> Import Teachers
    </button>
    <button class="btn btn-danger" onclick="teacherManager.resetForm()">
        <i class="fas fa-trash"></i> Clear Form
    </button>
</div>
*/
    </section>

    <!-- OTHER PANELS -->
    <section id="classes" class="panel">
      <div class="card">
        <h2><i class="fas fa-book"></i> Class Management</h2>
        <p>Class management features will be implemented here.</p>
      </div>
    </section>

    <section id="attendance" class="panel">
      <div class="card">
        <h2><i class="fas fa-clipboard-check"></i> Attendance Tracking</h2>
        <p>Attendance tracking features will be implemented here.</p>
      </div>
    </section>

    <section id="admissions" class="panel">
      <div class="card">
        <h2><i class="fas fa-file-signature"></i> Admissions Management</h2>
        <p>Admissions management features will be implemented here.</p>
      </div>
    </section>

    <section id="payments" class="panel">
      <div class="card">
        <h2><i class="fas fa-credit-card"></i> Payment Management</h2>
        <p>Payment management features will be implemented here.</p>
      </div>
    </section>

    <section id="reports" class="panel">
      <div class="card">
        <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
        <p>Reporting features will be implemented here.</p>
      </div>
    </section>

    <section id="messaging" class="panel">
      <div class="card">
        <h2><i class="fas fa-comments"></i> Messaging System</h2>
        <p>Messaging features will be implemented here.</p>
      </div>
    </section>

    <section id="audit" class="panel">
      <div class="card">
        <h2><i class="fas fa-history"></i> Audit Logs</h2>
        <p>Audit log features will be implemented here.</p>
      </div>
    </section>

    <section id="settings" class="panel">
      <div class="card">
        <h2><i class="fas fa-cog"></i> System Settings</h2>
        <p>System settings will be implemented here.</p>
      </div>
    </section>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification"></div>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div id="modalContent"></div>
      <button class="btn" onclick="app.closeModal()">Close</button>
    </div>
  </div>

  <script>
    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Set up navigation
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const panelId = this.getAttribute('data-panel');
          showPanel(panelId);
          
          // Update active state
          document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
          this.classList.add('active');
        });
      });

      // Initialize data display
      renderSpecialStudents();
      renderTeachers();
      updateDashboardStats();
    });

    // Panel navigation
    function showPanel(panelId) {
      document.querySelectorAll('.panel').forEach(panel => {
        panel.classList.remove('active');
      });
      document.getElementById(panelId).classList.add('active');
      
      // Update panel title
      const titles = {
        dashboard: "Dashboard",
        "special-students": "Special Students",
        teacher: "Teacher Management",
        classes: "Class Management",
        attendance: "Attendance Tracking",
        admissions: "Admissions Management",
        payments: "Payment Management",
        reports: "Reports & Analytics",
        messaging: "Messaging System",
        audit: "Audit Logs",
        settings: "System Settings"
      };
      document.getElementById('panelTitle').textContent = titles[panelId];
    }

    // Update dashboard statistics
    function updateDashboardStats() {
      // These would normally come from your database
      document.getElementById('specialStudentsCount').textContent = '25';
      document.getElementById('teacherCount').textContent = '18';
      document.getElementById('studentCount').textContent = '245';
      document.getElementById('classCount').textContent = '12';
      document.getElementById('totalTeacherCount').textContent = '18';
      document.getElementById('activeClassCount').textContent = '12';
    }

    // Notification system
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Modal system
    function openModal(content) {
      document.getElementById('modalContent').innerHTML = content;
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // Export functions (placeholder)
    function exportData() {
      showNotification('Data export started successfully!', 'success');
    }

    function generateReport() {
      showNotification('Report generation completed!', 'success');
    }

    // Global app object
    const app = {
      exportData,
      generateReport,
      closeModal,
      renderSpecialStudents: function() {
        // This would normally fetch from your database
        showNotification('Special students list updated', 'success');
      },
      cancelEdit: function() {
        document.getElementById('submitSpecialBtn').innerHTML = '<i class="fas fa-plus"></i> Add Special Student';
        document.getElementById('cancelEditBtn').style.display = 'none';
        document.getElementById('specialStudentsForm').reset();
        document.getElementById('specialPhotoPreview').src = 'https://placehold.co/100x100';
      },
      clearForm: function() {
        document.getElementById('specialStudentsForm').reset();
        document.getElementById('specialPhotoPreview').src = 'https://placehold.co/100x100';
      }
    };

// Special Students Management System with IndexedDB
const specialStudentsManager = {
    dbName: 'SpecialStudentsDB',
    dbVersion: 1,
    storeName: 'specialStudents',
    
    // Initialize the module
    init: function() {
        this.setupEventListeners();
        this.initDB().then(() => {
            this.renderStudents();
            this.updateStats();
        }).catch(error => {
            console.error('Failed to initialize database:', error);
            showNotification('Failed to initialize database', 'error');
        });
    },
    
    // Initialize IndexedDB
    initDB: function() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.dbVersion);
            
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(this.storeName)) {
                    const store = db.createObjectStore(this.storeName, { keyPath: 'id' });
                    store.createIndex('category', 'category', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('className', 'className', { unique: false });
                }
            };
        });
    },
    
    // Setup event listeners
    setupEventListeners: function() {
        // Form submission
        document.getElementById('specialStudentsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleFormSubmit();
        });
        
        // Search functionality
        document.getElementById('specialSearch').addEventListener('input', (e) => {
            this.handleSearch(e.target.value);
        });
        
        // Filter functionality
        document.getElementById('specialFilter').addEventListener('change', (e) => {
            this.handleFilter(e.target.value);
        });
        
        // Photo preview
        document.getElementById('specialPhoto').addEventListener('change', (e) => {
            this.previewImage(e.target, 'specialPhotoPreview');
        });
    },
    
    // Handle form submission
    handleFormSubmit: function() {
        const formData = this.getFormData();
        
        if (!this.validateForm(formData)) {
            return;
        }
        
        const editingId = document.getElementById('submitSpecialBtn').dataset.editingId;
        
        if (editingId) {
            // Update existing student
            this.updateStudent(editingId, formData).then(() => {
                showNotification('Student updated successfully!', 'success');
                this.resetForm();
                this.renderStudents();
                this.updateStats();
            }).catch(error => {
                console.error('Error updating student:', error);
                showNotification('Error updating student', 'error');
            });
        } else {
            // Add new student
            this.addStudent(formData).then(() => {
                showNotification('Student added successfully!', 'success');
                this.resetForm();
                this.renderStudents();
                this.updateStats();
            }).catch(error => {
                console.error('Error adding student:', error);
                showNotification('Error adding student', 'error');
            });
        }
    },
    
    // Get form data
    getFormData: function() {
        return {
            id: document.getElementById('specialId').value.trim(),
            name: document.getElementById('specialName').value.trim(),
            className: document.getElementById('specialClass').value.trim(),
            category: document.getElementById('specialCategory').value,
            email: document.getElementById('specialEmail').value.trim(),
            notes: document.getElementById('specialNotes').value.trim(),
            status: document.getElementById('specialStatus').value,
            enrollmentDate: document.getElementById('enrollmentDate').value,
            password: document.getElementById('specialPassword').value,
            photo: document.getElementById('specialPhotoPreview').src,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    },
    
    // Validate form data
    validateForm: function(data) {
        if (!data.id || !data.name || !data.className || !data.category) {
            showNotification('Please fill in all required fields', 'error');
            return false;
        }
        
        // For new students, check if ID already exists
        const editingId = document.getElementById('submitSpecialBtn').dataset.editingId;
        if (!editingId) {
            this.getStudent(data.id).then(existingStudent => {
                if (existingStudent) {
                    showNotification('Student ID already exists!', 'error');
                    return false;
                }
            }).catch(error => {
                console.error('Error checking student ID:', error);
            });
        }
        
        return true;
    },
    
    // Add new student
    addStudent: function(studentData) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.add(studentData);
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Update existing student
    updateStudent: function(studentId, studentData) {
        return new Promise((resolve, reject) => {
            // First get the existing student to preserve createdAt
            this.getStudent(studentId).then(existingStudent => {
                const updatedStudent = {
                    ...existingStudent,
                    ...studentData,
                    updatedAt: new Date().toISOString()
                };
                
                const transaction = this.db.transaction([this.storeName], 'readwrite');
                const store = transaction.objectStore(this.storeName);
                const request = store.put(updatedStudent);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            }).catch(error => reject(error));
        });
    },
    
    // Get single student by ID
    getStudent: function(studentId) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.get(studentId);
            
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },
    
    // Get all students
    getAllStudents: function() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.getAll();
            
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },
    
    // Delete student
    deleteStudent: function(studentId) {
        if (confirm('Are you sure you want to delete this student?')) {
            this.removeStudent(studentId).then(() => {
                this.renderStudents();
                this.updateStats();
                showNotification('Student deleted successfully!', 'success');
            }).catch(error => {
                console.error('Error deleting student:', error);
                showNotification('Error deleting student', 'error');
            });
        }
    },
    
    // Remove student from database
    removeStudent: function(studentId) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.delete(studentId);
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Edit student
    editStudent: function(studentId) {
        this.getStudent(studentId).then(student => {
            if (student) {
                // Fill form with student data
                document.getElementById('specialId').value = student.id;
                document.getElementById('specialName').value = student.name;
                document.getElementById('specialClass').value = student.className;
                document.getElementById('specialCategory').value = student.category;
                document.getElementById('specialEmail').value = student.email || '';
                document.getElementById('specialNotes').value = student.notes || '';
                document.getElementById('specialStatus').value = student.status;
                document.getElementById('enrollmentDate').value = student.enrollmentDate || '';
                document.getElementById('specialPassword').value = student.password || '';
                document.getElementById('specialPhotoPreview').src = student.photo || 'https://placehold.co/100x100';
                
                // Update button to show editing mode
                const submitBtn = document.getElementById('submitSpecialBtn');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Student';
                submitBtn.dataset.editingId = studentId;
                
                // Show cancel button
                document.getElementById('cancelEditBtn').style.display = 'inline-block';
                
                // Scroll to form
                document.getElementById('specialStudentsForm').scrollIntoView({ behavior: 'smooth' });
            }
        }).catch(error => {
            console.error('Error loading student for editing:', error);
            showNotification('Error loading student data', 'error');
        });
    },
    
    // Cancel editing
    cancelEdit: function() {
        this.resetForm();
    },
    
    // Reset form
    resetForm: function() {
        document.getElementById('specialStudentsForm').reset();
        document.getElementById('specialPhotoPreview').src = 'https://placehold.co/100x100';
        
        const submitBtn = document.getElementById('submitSpecialBtn');
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Special Student';
        delete submitBtn.dataset.editingId;
        
        document.getElementById('cancelEditBtn').style.display = 'none';
    },
    
    // Render students list
    renderStudents: function(studentsToRender = null) {
        const container = document.getElementById('specialStudentsList');
        
        if (studentsToRender) {
            this.displayStudents(container, studentsToRender);
        } else {
            this.getAllStudents().then(students => {
                this.displayStudents(container, students);
            }).catch(error => {
                console.error('Error loading students:', error);
                container.innerHTML = this.getErrorMessage('Failed to load students');
            });
        }
    },
    
    // Display students in the container
    displayStudents: function(container, students) {
        container.innerHTML = '';
        
        if (students.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                    <i class="fas fa-user-slash" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h3>No special students found</h3>
                    <p>Add your first special student using the form above.</p>
                </div>
            `;
            return;
        }
        
        students.forEach(student => {
            const card = document.createElement('div');
            card.className = 'student-card';
            card.innerHTML = this.createStudentCardHTML(student);
            container.appendChild(card);
        });
    },
    
    // Create student card HTML
    createStudentCardHTML: function(student) {
        const categoryLabels = {
            scholarship: 'Scholarship',
            honors: 'Honors Program',
            disabled: 'Special Needs',
            athlete: 'Student Athlete',
            international: 'International Student'
        };
        
        return `
            <div class="student-header">
                <img src="${student.photo || 'https://placehold.co/60x60'}" class="student-avatar" alt="${student.name}">
                <div class="student-info">
                    <h3>${student.name} <span class="category-badge badge-${student.category}">${categoryLabels[student.category]}</span></h3>
                    <p>ID: ${student.id} | Class: ${student.className}</p>
                </div>
            </div>
            <div class="student-details">
                <p><strong>Email:</strong> ${student.email || 'N/A'}</p>
                <p><strong>Status:</strong> <span class="status-indicator status-${student.status}"></span>${student.status}</p>
                <p><strong>Enrolled:</strong> ${student.enrollmentDate || 'N/A'}</p>
                <p><strong>Notes:</strong> ${student.notes || 'No special notes'}</p>
            </div>
            <div class="student-actions">
                <button class="btn btn-warning" onclick="specialStudentsManager.editStudent('${student.id}')">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" onclick="specialStudentsManager.deleteStudent('${student.id}')">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        `;
    },
    
    // Handle search
    handleSearch: function(searchTerm) {
        if (!searchTerm) {
            this.renderStudents();
            return;
        }
        
        this.getAllStudents().then(allStudents => {
            const filtered = allStudents.filter(student => 
                student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                student.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
                student.className.toLowerCase().includes(searchTerm.toLowerCase()) ||
                student.email.toLowerCase().includes(searchTerm.toLowerCase())
            );
            this.renderStudents(filtered);
        }).catch(error => {
            console.error('Error searching students:', error);
        });
    },
    
    // Handle filter
    handleFilter: function(filterValue) {
        if (filterValue === 'all') {
            this.renderStudents();
            return;
        }
        
        this.getAllStudents().then(allStudents => {
            const filtered = allStudents.filter(student => student.category === filterValue);
            this.renderStudents(filtered);
        }).catch(error => {
            console.error('Error filtering students:', error);
        });
    },
    
    // Update statistics
    updateStats: function() {
        this.getAllStudents().then(students => {
            const totalStudents = students.length;
            const activeStudents = students.filter(s => s.status === 'active').length;
            
            // Update dashboard stats
            document.getElementById('specialStudentsCount').textContent = totalStudents;
            
            // Update category counts
            const categoryCounts = {
                scholarship: students.filter(s => s.category === 'scholarship').length,
                honors: students.filter(s => s.category === 'honors').length,
                disabled: students.filter(s => s.category === 'disabled').length,
                athlete: students.filter(s => s.category === 'athlete').length,
                international: students.filter(s => s.category === 'international').length
            };
            
            // You can update any other UI elements with these counts
            console.log('Category counts:', categoryCounts);
        }).catch(error => {
            console.error('Error updating stats:', error);
        });
    },
    
    // Export students data
    exportStudents: function() {
        this.getAllStudents().then(students => {
            const dataStr = JSON.stringify(students, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `special-students-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Student data exported successfully!', 'success');
        }).catch(error => {
            console.error('Error exporting students:', error);
            showNotification('Error exporting student data', 'error');
        });
    },
    
    // Import students data
    importStudents: function(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedData = JSON.parse(e.target.result);
                
                if (Array.isArray(importedData)) {
                    this.getAllStudents().then(existingStudents => {
                        const importPromises = importedData.map(newStudent => {
                            // Check if student already exists
                            const exists = existingStudents.some(student => student.id === newStudent.id);
                            if (!exists) {
                                // Add createdAt and updatedAt if missing
                                const studentToAdd = {
                                    ...newStudent,
                                    createdAt: newStudent.createdAt || new Date().toISOString(),
                                    updatedAt: new Date().toISOString()
                                };
                                return this.addStudent(studentToAdd);
                            }
                            return Promise.resolve();
                        });
                        
                        Promise.all(importPromises).then(() => {
                            this.renderStudents();
                            this.updateStats();
                            showNotification('Students imported successfully!', 'success');
                        }).catch(error => {
                            console.error('Error during import:', error);
                            showNotification('Error importing some students', 'error');
                        });
                    }).catch(error => {
                        console.error('Error checking existing students:', error);
                        showNotification('Error importing file', 'error');
                    });
                } else {
                    showNotification('Invalid file format', 'error');
                }
            } catch (error) {
                showNotification('Error importing file', 'error');
            }
        };
        reader.readAsText(file);
    },
    
    // Preview image
    previewImage: function(input, previewId) {
        const preview = document.getElementById(previewId);
        const file = input.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.addEventListener('load', function() {
                preview.src = reader.result;
            });
            reader.readAsDataURL(file);
        }
    },
    
    // Generate sample data (for testing)
    generateSampleData: function() {
        const sampleStudents = [
            {
                id: 'SO2024001',
                name: 'Alex Johnson',
                className: 'Grade 5 - Blue',
                category: 'scholarship',
                email: 'alex.johnson@superowly.edu',
                status: 'active',
                enrollmentDate: '2024-01-15',
                notes: 'Excellent in mathematics, receives full scholarship',
                password: 'password123',
                photo: 'https://placehold.co/100x100',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'SO2024002',
                name: 'Emma Wilson',
                className: 'Grade 5 - Blue',
                category: 'honors',
                email: 'emma.wilson@superowly.edu',
                status: 'active',
                enrollmentDate: '2024-01-15',
                notes: 'Honors program, advanced science curriculum',
                password: 'password123',
                photo: 'https://placehold.co/100x100',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'SO2024003',
                name: 'Noah Brown',
                className: 'Grade 4 - Green',
                category: 'disabled',
                email: 'noah.brown@superowly.edu',
                status: 'active',
                enrollmentDate: '2024-01-10',
                notes: 'Special needs - requires extra time for tests and assignments',
                password: 'password123',
                photo: 'https://placehold.co/100x100',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
        
        // Clear existing data first
        this.clearAllStudents().then(() => {
            const addPromises = sampleStudents.map(student => this.addStudent(student));
            return Promise.all(addPromises);
        }).then(() => {
            this.renderStudents();
            this.updateStats();
            showNotification('Sample data generated!', 'success');
        }).catch(error => {
            console.error('Error generating sample data:', error);
            showNotification('Error generating sample data', 'error');
        });
    },
    
    // Clear all students (for sample data generation)
    clearAllStudents: function() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.clear();
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Get error message HTML
    getErrorMessage: function(message) {
        return `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--danger);">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 15px;"></i>
                <h3>Error</h3>
                <p>${message}</p>
            </div>
        `;
    }
};
// Initialize the special students manager when the page loads
document.addEventListener('DOMContentLoaded', function() {
    specialStudentsManager.init();
});


  // Teacher Management System with IndexedDB
const teacherManager = {
    dbName: 'TeachersDB',
    dbVersion: 1,
    storeName: 'teachers',
    
    // Initialize the module
    init: function() {
        this.setupEventListeners();
        this.initDB().then(() => {
            this.renderTeachers();
            this.updateStats();
        }).catch(error => {
            console.error('Failed to initialize database:', error);
            showNotification('Failed to initialize database', 'error');
        });
    },
    
    // Initialize IndexedDB
    initDB: function() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.dbVersion);
            
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(this.storeName)) {
                    const store = db.createObjectStore(this.storeName, { keyPath: 'id' });
                    store.createIndex('class', 'class', { unique: false });
                    store.createIndex('status', 'status', { unique: false });
                    store.createIndex('email', 'email', { unique: true });
                }
            };
        });
    },
    
    // Setup event listeners
    setupEventListeners: function() {
        // Form submission
        document.getElementById('teacherForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleFormSubmit();
        });
        
        // Photo preview
        document.getElementById('teacherPhotoInput').addEventListener('change', (e) => {
            this.previewImage(e.target, 'teacherPhotoPreview');
        });
    },
    
    // Handle form submission
    handleFormSubmit: function() {
        const formData = this.getFormData();
        
        if (!this.validateForm(formData)) {
            return;
        }
        
        const editingId = document.getElementById('saveTeacherBtn').dataset.editingId;
        
        if (editingId) {
            // Update existing teacher
            this.updateTeacher(editingId, formData).then(() => {
                showNotification('Teacher updated successfully!', 'success');
                this.resetForm();
                this.renderTeachers();
                this.updateStats();
            }).catch(error => {
                console.error('Error updating teacher:', error);
                showNotification('Error updating teacher', 'error');
            });
        } else {
            // Add new teacher
            this.addTeacher(formData).then(() => {
                showNotification('Teacher added successfully!', 'success');
                this.resetForm();
                this.renderTeachers();
                this.updateStats();
            }).catch(error => {
                console.error('Error adding teacher:', error);
                showNotification('Error adding teacher', 'error');
            });
        }
    },
    
    // Get form data
    getFormData: function() {
        return {
            id: document.getElementById('teacherIDInput').value.trim(),
            name: document.getElementById('teacherNameInput').value.trim(),
            class: document.getElementById('teacherClassInput').value.trim(),
            email: document.getElementById('teacherEmailInput').value.trim(),
            password: document.getElementById('teacherPasswordInput').value,
            photo: document.getElementById('teacherPhotoPreview').src,
            status: 'active',
            joinDate: new Date().toISOString().split('T')[0],
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
    },
    
    // Validate form data
    validateForm: function(data) {
        if (!data.id || !data.name || !data.class || !data.password) {
            showNotification('Please fill in all required fields', 'error');
            return false;
        }
        
        // For new teachers, check if ID already exists
        const editingId = document.getElementById('saveTeacherBtn').dataset.editingId;
        if (!editingId) {
            this.getTeacher(data.id).then(existingTeacher => {
                if (existingTeacher) {
                    showNotification('Teacher ID already exists!', 'error');
                    return false;
                }
            }).catch(error => {
                console.error('Error checking teacher ID:', error);
            });
        }
        
        return true;
    },
    
    // Add new teacher
    addTeacher: function(teacherData) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.add(teacherData);
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Update existing teacher
    updateTeacher: function(teacherId, teacherData) {
        return new Promise((resolve, reject) => {
            // First get the existing teacher to preserve createdAt
            this.getTeacher(teacherId).then(existingTeacher => {
                const updatedTeacher = {
                    ...existingTeacher,
                    ...teacherData,
                    updatedAt: new Date().toISOString()
                };
                
                const transaction = this.db.transaction([this.storeName], 'readwrite');
                const store = transaction.objectStore(this.storeName);
                const request = store.put(updatedTeacher);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            }).catch(error => reject(error));
        });
    },
    
    // Get single teacher by ID
    getTeacher: function(teacherId) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.get(teacherId);
            
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },
    
    // Get all teachers
    getAllTeachers: function() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readonly');
            const store = transaction.objectStore(this.storeName);
            const request = store.getAll();
            
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    },
    
    // Delete teacher
    deleteTeacher: function(teacherId) {
        if (confirm('Are you sure you want to delete this teacher?')) {
            this.removeTeacher(teacherId).then(() => {
                this.renderTeachers();
                this.updateStats();
                showNotification('Teacher deleted successfully!', 'success');
            }).catch(error => {
                console.error('Error deleting teacher:', error);
                showNotification('Error deleting teacher', 'error');
            });
        }
    },
    
    // Remove teacher from database
    removeTeacher: function(teacherId) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.delete(teacherId);
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Edit teacher
    editTeacher: function(teacherId) {
        this.getTeacher(teacherId).then(teacher => {
            if (teacher) {
                // Fill form with teacher data
                document.getElementById('teacherIDInput').value = teacher.id;
                document.getElementById('teacherNameInput').value = teacher.name;
                document.getElementById('teacherClassInput').value = teacher.class;
                document.getElementById('teacherEmailInput').value = teacher.email || '';
                document.getElementById('teacherPasswordInput').value = teacher.password || '';
                document.getElementById('teacherPhotoPreview').src = teacher.photo || 'https://placehold.co/100x100';
                
                // Update button to show editing mode
                const saveBtn = document.getElementById('saveTeacherBtn');
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Update Teacher';
                saveBtn.dataset.editingId = teacherId;
                
                // Scroll to form
                document.getElementById('teacherForm').scrollIntoView({ behavior: 'smooth' });
            }
        }).catch(error => {
            console.error('Error loading teacher for editing:', error);
            showNotification('Error loading teacher data', 'error');
        });
    },
    
    // Reset form
    resetForm: function() {
        document.getElementById('teacherForm').reset();
        document.getElementById('teacherPhotoPreview').src = 'https://placehold.co/100x100';
        
        const saveBtn = document.getElementById('saveTeacherBtn');
        saveBtn.innerHTML = '<i class="fas fa-plus"></i> Add Teacher';
        delete saveBtn.dataset.editingId;
    },
    
    // Render teachers list
    renderTeachers: function() {
        const tbody = document.querySelector("#teacherTable tbody");
        
        this.getAllTeachers().then(teachers => {
            this.displayTeachers(tbody, teachers);
        }).catch(error => {
            console.error('Error loading teachers:', error);
            tbody.innerHTML = this.getErrorMessage('Failed to load teachers');
        });
    },
    
    // Display teachers in the table
    displayTeachers: function(tbody, teachers) {
        tbody.innerHTML = '';
        
        if (teachers.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-chalkboard-teacher" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                        <h4>No teachers found</h4>
                        <p>Add your first teacher using the form above.</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        teachers.forEach(teacher => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>
                    <img src="${teacher.photo || 'https://placehold.co/40x40'}" 
                         width="40" height="40" 
                         style="border-radius:50%;object-fit:cover;" 
                         alt="${teacher.name}">
                </td>
                <td>
                    <strong>${teacher.name}</strong>
                    <br>
                    <small style="color: var(--gray);">
                        <span class="status-indicator status-${teacher.status}"></span>${teacher.status}
                    </small>
                </td>
                <td>${teacher.id}</td>
                <td>${teacher.class}</td>
                <td>${teacher.email || 'N/A'}</td>
                <td>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button class="btn btn-warning" 
                                onclick="teacherManager.editTeacher('${teacher.id}')"
                                style="padding: 5px 10px; font-size: 14px;">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" 
                                onclick="teacherManager.deleteTeacher('${teacher.id}')"
                                style="padding: 5px 10px; font-size: 14px;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(tr);
        });
    },
    
    // Update statistics
    updateStats: function() {
        this.getAllTeachers().then(teachers => {
            const totalTeachers = teachers.length;
            document.getElementById('teacherCount').textContent = totalTeachers;
            document.getElementById('totalTeacherCount').textContent = totalTeachers;
        }).catch(error => {
            console.error('Error updating stats:', error);
        });
    },
    
    // Export teachers data
    exportTeachers: function() {
        this.getAllTeachers().then(teachers => {
            const dataStr = JSON.stringify(teachers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `teachers-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Teacher data exported successfully!', 'success');
        }).catch(error => {
            console.error('Error exporting teachers:', error);
            showNotification('Error exporting teacher data', 'error');
        });
    },
    
    // Import teachers data
    importTeachers: function(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedData = JSON.parse(e.target.result);
                
                if (Array.isArray(importedData)) {
                    this.getAllTeachers().then(existingTeachers => {
                        const importPromises = importedData.map(newTeacher => {
                            // Check if teacher already exists
                            const exists = existingTeachers.some(teacher => teacher.id === newTeacher.id);
                            if (!exists) {
                                // Add createdAt and updatedAt if missing
                                const teacherToAdd = {
                                    ...newTeacher,
                                    createdAt: newTeacher.createdAt || new Date().toISOString(),
                                    updatedAt: new Date().toISOString()
                                };
                                return this.addTeacher(teacherToAdd);
                            }
                            return Promise.resolve();
                        });
                        
                        Promise.all(importPromises).then(() => {
                            this.renderTeachers();
                            this.updateStats();
                            showNotification('Teachers imported successfully!', 'success');
                        }).catch(error => {
                            console.error('Error during import:', error);
                            showNotification('Error importing some teachers', 'error');
                        });
                    }).catch(error => {
                        console.error('Error checking existing teachers:', error);
                        showNotification('Error importing file', 'error');
                    });
                } else {
                    showNotification('Invalid file format', 'error');
                }
            } catch (error) {
                showNotification('Error importing file', 'error');
            }
        };
        reader.readAsText(file);
    },
    
    // Preview image
    previewImage: function(input, previewId) {
        const preview = document.getElementById(previewId);
        const file = input.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.addEventListener('load', function() {
                preview.src = reader.result;
            });
            reader.readAsDataURL(file);
        }
    },
    
    // Generate sample data (for testing)
    generateSampleData: function() {
        const sampleTeachers = [
            {
                id: 'T2024001',
                name: 'Ms. Sarah Johnson',
                class: 'Grade 5 - Blue',
                email: 'sarah.johnson@superowly.edu',
                password: 'teacher123',
                photo: 'https://placehold.co/100x100',
                status: 'active',
                joinDate: '2020-08-15',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            },
            {
                id: 'T2024002',
                name: 'Mr. James Wilson',
                class: 'Grade 4 - Green',
                email: 'james.wilson@superowly.edu',
                password: 'teacher123',
                photo: 'https://placehold.co/100x100',
                status: 'active',
                joinDate: '2021-01-10',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            }
        ];
        
        // Clear existing data first
        this.clearAllTeachers().then(() => {
            const addPromises = sampleTeachers.map(teacher => this.addTeacher(teacher));
            return Promise.all(addPromises);
        }).then(() => {
            this.renderTeachers();
            this.updateStats();
            showNotification('Sample teacher data generated!', 'success');
        }).catch(error => {
            console.error('Error generating sample data:', error);
            showNotification('Error generating sample data', 'error');
        });
    },
    
    // Clear all teachers (for sample data generation)
    clearAllTeachers: function() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction([this.storeName], 'readwrite');
            const store = transaction.objectStore(this.storeName);
            const request = store.clear();
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    },
    
    // Get error message HTML
    getErrorMessage: function(message) {
        return `
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: var(--danger);">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>
                    <h4>Error</h4>
                    <p>${message}</p>
                </td>
            </tr>
        `;
    },
    
    // Search teachers by name, ID, or class
    searchTeachers: function(searchTerm) {
        this.getAllTeachers().then(teachers => {
            const filtered = teachers.filter(teacher => 
                teacher.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                teacher.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
                teacher.class.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (teacher.email && teacher.email.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            
            const tbody = document.querySelector("#teacherTable tbody");
            this.displayTeachers(tbody, filtered);
        }).catch(error => {
            console.error('Error searching teachers:', error);
        });
    },
    
    // Filter teachers by class
    filterTeachersByClass: function(className) {
        if (className === 'all') {
            this.renderTeachers();
            return;
        }
        
        this.getAllTeachers().then(teachers => {
            const filtered = teachers.filter(teacher => teacher.class === className);
            const tbody = document.querySelector("#teacherTable tbody");
            this.displayTeachers(tbody, filtered);
        }).catch(error => {
            console.error('Error filtering teachers:', error);
        });
    }
};

// Initialize the teacher manager when the page loads
document.addEventListener('DOMContentLoaded', function() {
    teacherManager.init();
});

// Helper functions
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function showPanel(panelId) {
    document.querySelectorAll('.panel').forEach(panel => {
        panel.classList.remove('active');
    });
    document.getElementById(panelId).classList.add('active');
    
    const titles = {
        dashboard: "Dashboard",
        "special-students": "Special Students",
        teacher: "Teacher Management",
        classes: "Class Management",
        attendance: "Attendance Tracking",
        admissions: "Admissions Management",
        payments: "Payment Management",
        reports: "Reports & Analytics",
        messaging: "Messaging System",
        audit: "Audit Logs",
        settings: "System Settings"
    };
    document.getElementById('panelTitle').textContent = titles[panelId];
}

  </script>
</body>
</html>